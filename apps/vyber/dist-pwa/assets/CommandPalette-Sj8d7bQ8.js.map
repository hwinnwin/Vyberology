{"version":3,"file":"CommandPalette-Sj8d7bQ8.js","sources":["../../src/components/ai/CommandPalette.tsx"],"sourcesContent":["import { useEffect, useRef } from \"react\";\nimport { X, Sparkles, Send, Loader2, Trash2, Search, ExternalLink, Globe } from \"lucide-react\";\nimport { useAIStore, SearchResult } from \"@/stores/ai\";\nimport { useTabsStore } from \"@/stores/tabs\";\nimport { cn } from \"@/lib/utils\";\n\nconst SUGGESTIONS = [\n  \"What is the latest news today?\",\n  \"Search for React 19 features\",\n  \"Compare iPhone 15 vs Samsung S24\",\n  \"How to learn TypeScript?\",\n  \"What's the weather like?\",\n];\n\nexport function CommandPalette() {\n  const {\n    isOpen,\n    isLoading,\n    isSearching,\n    messages,\n    currentInput,\n    close,\n    setInput,\n    sendMessage,\n    clearMessages,\n  } = useAIStore();\n\n  const { navigate, activeTabId } = useTabsStore();\n  const inputRef = useRef<HTMLInputElement>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Focus input when opened\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isOpen]);\n\n  // Scroll to bottom on new messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  // Handle keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\" && isOpen) {\n        close();\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [isOpen, close]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!currentInput.trim() || isLoading) return;\n    await sendMessage(currentInput.trim());\n  };\n\n  const handleSuggestionClick = (suggestion: string) => {\n    setInput(suggestion);\n    inputRef.current?.focus();\n  };\n\n  const handleOpenUrl = (url: string) => {\n    if (activeTabId) {\n      navigate(activeTabId, url);\n      close();\n    }\n  };\n\n  // Render search results card\n  const renderSearchResults = (results: SearchResult[]) => (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n        <Search className=\"h-3 w-3\" />\n        <span>Sources</span>\n      </div>\n      <div className=\"flex flex-wrap gap-2\">\n        {results.slice(0, 5).map((result, i) => (\n          <button\n            key={i}\n            onClick={() => handleOpenUrl(result.url)}\n            className=\"group flex items-center gap-2 rounded-lg border border-border bg-secondary/50 px-3 py-2 text-left transition-all hover:border-vyber-purple/50 hover:bg-secondary\"\n          >\n            <div className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-md bg-gradient-to-br from-vyber-purple/20 to-vyber-pink/20\">\n              <Globe className=\"h-3 w-3 text-vyber-purple\" />\n            </div>\n            <div className=\"min-w-0 flex-1\">\n              <p className=\"truncate text-xs font-medium\">{result.title}</p>\n              <p className=\"truncate text-[10px] text-muted-foreground\">{new URL(result.url).hostname}</p>\n            </div>\n            <ExternalLink className=\"h-3 w-3 shrink-0 opacity-0 transition-opacity group-hover:opacity-100\" />\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n\n  // Parse assistant messages for URLs and make them clickable\n  const parseMessageForURLs = (content: string) => {\n    // Handle citations like [1], [2]\n    const citationRegex = /\\[(\\d+)\\]/g;\n    const urlRegex = /(https?:\\/\\/[^\\s]+)/g;\n\n    let result = content;\n\n    // Replace URLs with clickable links\n    const parts = result.split(urlRegex);\n\n    return parts.map((part, i) => {\n      if (part.match(urlRegex)) {\n        return (\n          <button\n            key={i}\n            onClick={() => handleOpenUrl(part)}\n            className=\"text-vyber-cyan underline hover:text-vyber-purple\"\n          >\n            {part}\n          </button>\n        );\n      }\n      // Replace citation numbers with styled badges\n      const citationParts = part.split(citationRegex);\n      return citationParts.map((cp, j) => {\n        if (/^\\d+$/.test(cp)) {\n          return (\n            <span\n              key={`${i}-${j}`}\n              className=\"mx-0.5 inline-flex h-4 w-4 items-center justify-center rounded-full bg-vyber-purple/20 text-[10px] font-medium text-vyber-purple\"\n            >\n              {cp}\n            </span>\n          );\n        }\n        return cp;\n      });\n    });\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-start justify-center pt-12 sm:pt-20\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"vyber-ai-title\">\n      {/* Backdrop */}\n      <div\n        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        onClick={close}\n      />\n\n      {/* Palette */}\n      <div className=\"relative z-10 mx-4 w-full max-w-2xl rounded-2xl border border-border bg-background shadow-2xl\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between border-b border-border px-4 py-3\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-vyber-purple to-vyber-pink\">\n              <Sparkles className=\"h-4 w-4 text-white\" />\n            </div>\n            <div>\n              <h2 id=\"vyber-ai-title\" className=\"text-sm font-semibold\">Vyber AI</h2>\n              <p className=\"text-xs text-muted-foreground\">\n                Search the web & get instant answers\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {messages.length > 0 && (\n              <button\n                onClick={clearMessages}\n                className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-secondary hover:text-foreground\"\n                title=\"Clear conversation\"\n                aria-label=\"Clear conversation\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </button>\n            )}\n            <button\n              onClick={close}\n              className=\"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-secondary hover:text-foreground\"\n              aria-label=\"Close command palette\"\n            >\n              <X className=\"h-4 w-4\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Messages */}\n        {messages.length > 0 && (\n          <div className=\"max-h-[60vh] overflow-y-auto p-4\">\n            <div className=\"space-y-4\">\n              {messages.map((message) => (\n                <div\n                  key={message.id}\n                  className={cn(\n                    \"flex\",\n                    message.role === \"user\" ? \"justify-end\" : \"justify-start\"\n                  )}\n                >\n                  {message.role === \"search\" && message.searchResults ? (\n                    <div className=\"w-full\">\n                      {renderSearchResults(message.searchResults)}\n                    </div>\n                  ) : (\n                    <div\n                      className={cn(\n                        \"max-w-[85%] select-text rounded-2xl px-4 py-2 text-sm\",\n                        message.role === \"user\"\n                          ? \"bg-vyber-purple text-white\"\n                          : \"bg-secondary text-foreground\"\n                      )}\n                    >\n                      {message.role === \"assistant\"\n                        ? parseMessageForURLs(message.content)\n                        : message.content}\n                    </div>\n                  )}\n                </div>\n              ))}\n              {(isLoading || isSearching) && (\n                <div className=\"flex justify-start\">\n                  <div className=\"flex items-center gap-2 rounded-2xl bg-secondary px-4 py-2 text-sm text-muted-foreground\">\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    {isSearching ? \"Searching the web...\" : \"Thinking...\"}\n                  </div>\n                </div>\n              )}\n              <div ref={messagesEndRef} />\n            </div>\n          </div>\n        )}\n\n        {/* Suggestions (when no messages) */}\n        {messages.length === 0 && (\n          <div className=\"p-4\">\n            <p className=\"mb-3 text-xs text-muted-foreground\">Ask anything - I'll search the web for you:</p>\n            <div className=\"flex flex-wrap gap-2\">\n              {SUGGESTIONS.map((suggestion) => (\n                <button\n                  key={suggestion}\n                  onClick={() => handleSuggestionClick(suggestion)}\n                  className=\"rounded-full border border-border bg-secondary/30 px-3 py-1.5 text-xs text-muted-foreground transition-colors hover:border-vyber-purple/50 hover:text-foreground\"\n                >\n                  {suggestion}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Input */}\n        <form onSubmit={handleSubmit} className=\"border-t border-border p-4\">\n          <div className=\"flex items-center gap-3\">\n            <Search className=\"h-4 w-4 shrink-0 text-muted-foreground\" />\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={currentInput}\n              onChange={(e) => setInput(e.target.value)}\n              placeholder=\"Ask anything...\"\n              aria-label=\"Ask Vyber AI\"\n              autoCapitalize=\"off\"\n              autoCorrect=\"off\"\n              autoComplete=\"off\"\n              spellCheck={false}\n              className=\"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground\"\n              disabled={isLoading}\n            />\n            <button\n              type=\"submit\"\n              disabled={!currentInput.trim() || isLoading}\n              className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-r from-vyber-purple to-vyber-pink text-white transition-opacity disabled:opacity-50\"\n            >\n              {isLoading ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                <Send className=\"h-4 w-4\" />\n              )}\n            </button>\n          </div>\n        </form>\n\n        {/* Footer */}\n        <div className=\"border-t border-border px-4 py-2 text-center text-xs text-muted-foreground/50\">\n          Press <kbd className=\"rounded bg-secondary px-1\">Esc</kbd> to close â€¢\n          Web search + Claude AI\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["SUGGESTIONS","CommandPalette","isOpen","isLoading","isSearching","messages","currentInput","close","setInput","sendMessage","clearMessages","useAIStore","navigate","activeTabId","useTabsStore","inputRef","useRef","messagesEndRef","useEffect","handleKeyDown","e","handleSubmit","handleSuggestionClick","suggestion","handleOpenUrl","url","renderSearchResults","results","jsxs","jsx","Search","result","i","Globe","ExternalLink","parseMessageForURLs","content","citationRegex","urlRegex","part","cp","j","Sparkles","Trash2","X","message","cn","Loader2","Send"],"mappings":"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"}